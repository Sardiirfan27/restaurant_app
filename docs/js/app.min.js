"use strict";var appParams={start_url:"https://katerina-tziala.github.io/restaurant/index.html",scope:"/",endpoints:{restaurants:"https://restrevsdb-0f34.restdb.io/rest/restaurants",reviews:"https://restrevsdb-0f34.restdb.io/rest/reviews"},indexFiles:{js:["/restaurant/js/index.min.js"],css:["/restaurant/css/index.min.css"]},restaurantFiles:{js:["/restaurant/js/restaurant.min.js"],css:["/restaurant/css/restaurant.min.css"]},mapBox:{leaflet_tile_layer_link:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",leaflet_params:{mapboxToken:"pk.eyJ1Ijoia2F0ZXJpbmF0emlhbGEiLCJhIjoiY2pwenNqdHF3MGU5MDQ4bzRudGdlanZ6eCJ9.kGbzX08otPecWpIvfKU3ZA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"},cssFile:{type:"text/css",rel:"stylesheet",href:"https://unpkg.com/leaflet@1.3.1/dist/leaflet.css",integrity:"sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==",crossorigin:" "},jsFile:{type:"application/javascript",src:"https://unpkg.com/leaflet@1.3.1/dist/leaflet.js",integrity:"sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==",crossorigin:" ",charset:"utf-8"}},cssClasses:{hidden:"hidden",spinClass:"spin",displayMap:"displaymap",disableMapButton:"disabled",displayNotification:"display_notification",freezer:"freezer"},noResultsFetchingMessages:{restaurants:"<span>No results matching your criteria!</span><span>Please try again!</span><i>Hint: Search with a different combination of neighborhoods and cuisines!</i>",reviews:"<span>No reviews yet!</span>"},notifications:{clear:{title:"",message:"",type:"cleared"},map_failure:{title:"Ooops!",message:"Map wasn't loaded successfully! Please try again.",type:"map_failure"},online:{title:"You are back online!",message:"Internet connection was successfully re-established!",type:"online"},offline:{title:"Unable to connect! retrying...",message:"You are able to use the Restaurant Reviews app while offline!",type:"offline"},offline_noMap:{title:"Unable to connect! retrying...",message:"You are able to use the Restaurant Reviews app while offline!<br><i><b>Notice: </b>The map is not currently available since it was not loaded yet!<i>",type:"offline_noMap"},unable_to_connect_retrying:{title:"Unable to connect!",message:'Retrying in <span id="message_timer"></span>',type:"unable_to_connect_retrying"},update:{title:"update available",message:"A new version of the Restaurant Reviews app is available!",type:"update"},failed_request_cached:{title:"Unable to connect! retrying...",message:"Your changes will be saved as soon as connection is re-established!",type:"failed_request_cached"},failed_request:{title:"Unable to connect!",message:"Your changes were not saved! Please try again later!",type:"failed_request"},unsaved_changes:{title:'You have <span id="unsaved_number"></span> unsaved <span id="unsaved_changes"></span>!',message:'Your changes will be saved in <span id="message_timer">10<span>',type:"unsaved_changes"},refresh:{title:"All your changes were successfully saved!",message:"Refresh the app or reload the page to see the latest changes!",type:"refresh"},saving_changes:{title:"Your changes are being saved!",message:"Please wait...<br>You will be notified for the result as soon as possible",type:"saving_changes"}}};
"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,o){var r,i=new Promise(function(i,u){e(r=t[n].apply(t,o)).then(i,u)});return i.request=r,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return t(this[n],r,arguments)})})}function r(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function i(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[n],(o=t(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function u(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}n(u,"_index",["name","keyPath","multiEntry","unique"]),o(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),o(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),s.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},n(s,"_store",["name","keyPath","indexNames","autoIncrement"]),o(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},n(a,"_tx",["objectStoreNames","mode"]),r(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),r(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),r(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[s,u].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}}})}),[u,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var d={open:function(e,n,o){var r=t(indexedDB,"open",[e,n]),i=r.request;return i.onupgradeneeded=function(e){o&&o(new p(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DataStore=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,e),this.cachename="rr-app",this.openDatabase(t)}return _createClass(e,[{key:"openDatabase",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cache=idb.open(this.cachename,1,function(t){switch(t.oldVersion){case 0:e.createStore(t,"restaurants");e.createStore(t,"reviews").createIndex("byRestaurant","restaurant_id");e.createStore(t,"failedRequests",!0)}})}},{key:"createStore",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.createObjectStore(t,{keyPath:"id",autoIncrement:n})}},{key:"getCachedData",value:function(e){return this.cache.then(function(t){return t.transaction(e).objectStore(e).getAll()})}},{key:"getCachedDataById",value:function(e,t){return this.cache.then(function(n){return n.transaction(e).objectStore(e).getAll(t)})}},{key:"getCachedDataByIndex",value:function(e,t,n){return this.cache.then(function(a){return a.transaction(e).objectStore(e).index(t).getAll(n)})}},{key:"getStoreKeys",value:function(e){return this.cache.then(function(t){return t.transaction(e).objectStore(e).getAllKeys()})}},{key:"cacheAll",value:function(e,t){this.cache.then(function(n){var a=n.transaction(e,"readwrite").objectStore(e);t.forEach(function(e){a.put(e)})})}},{key:"cacheOne",value:function(e,t){this.cacheAll(e,[t])}},{key:"deleteOne",value:function(e,t){this.cache.then(function(n){n.transaction(e,"readwrite").objectStore(e).delete(t)})}},{key:"deleteAll",value:function(e){this.cache.then(function(t){t.transaction(e,"readwrite").objectStore(e).clear()})}}]),e}();
"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchData",value:async function(t){var a=new Request(t,{method:"GET",mode:"cors",cache:"reload",credentials:"same-origin",headers:e.REQUEST_HEADERS});try{var r=fetch(a),n=await r,i=await n.json();return Promise.resolve(i)}catch(e){throw Error(e)}}},{key:"getData",value:function(t,a,r){e.fetchData(t,a).then(function(t){var n={target:a};if("restaurants"===a||"reviews"===a){var i=a.substring(0,a.length-1),u=e.refactorData(i,t);n.data=u,e.updateIndexedDB(n,"GETALL")}else{var s=e.refactorData(a,[t])[0];n.data=s,e.updateIndexedDB(n,"GET")}r(null,n.data)}).catch(function(e){return r(e,null)})}},{key:"refactorData",value:function(e,t){var a=JSON.parse(JSON.stringify(t));switch(e){case"restaurant":return a.forEach(function(e){e.is_favorite="is_favorite"in e&&"true"===e.is_favorite.toString(),"photograph"in e||(e.photograph=e.id.toString())}),a;default:return a}}},{key:"updateIndexedDB",value:function(t,a){if(e.INDEXED_DB_SUPPORT)switch(a){case"GETALL":e.AppStore.cacheAll(t.target,t.data);break;case"DELETE":e.AppStore.deleteOne(t.target+"s",t.data.id);break;default:e.AppStore.cacheOne(t.target+"s",t.data)}}},{key:"fetchRestaurants",value:function(t){e.INDEXED_DB_SUPPORT?e.AppStore.getCachedData("restaurants").then(function(a){a.length>0&&(t(null,a),t=function(){}),e.getData(e.RESTAURANTS_URL,"restaurants",t)}):e.getData(e.RESTAURANTS_URL,"restaurants",t)}},{key:"fetchRestaurantById",value:function(t,a){e.INDEXED_DB_SUPPORT?e.AppStore.getCachedDataById("restaurants",parseInt(t)).then(function(r){r.length>0&&(a(null,r[0]),a=function(){}),e.getData(e.RESTAURANTS_URL+"/"+t,"restaurant",a)}):e.getData(e.RESTAURANTS_URL+"/"+t,"restaurant",a)}},{key:"fetchReviews",value:function(t){e.INDEXED_DB_SUPPORT?e.AppStore.getCachedData("reviews").then(function(a){a.length>0&&(t(null,a),t=function(){}),e.getData(e.REVIEWS_URL,"reviews",t)}):e.getData(e.REVIEWS_URL,"reviews",t)}},{key:"fetchRestaurantReviews",value:function(t,a){e.INDEXED_DB_SUPPORT?e.AppStore.getCachedDataByIndex("reviews","byRestaurant",t).then(function(r){r.length>0&&(a(null,r),a=function(){}),e.getData(e.REVIEWS_URL+"?restaurant_id="+t,"reviews",a)}):e.getData(e.REVIEWS_URL+"?restaurant_id="+t,"reviews",a)}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,a,r){e.fetchRestaurants(function(e,n){if(e)r(e,null);else{var i=n;"all"!=t&&(i=i.filter(function(e){return e.cuisine_type==t})),"all"!=a&&(i=i.filter(function(e){return e.neighborhood==a})),r(null,i)}})}},{key:"fetchUniqueRestaurantParams",value:function(t,a){e.fetchRestaurants(function(e,r){if(e)a(e,null);else{var n=r.map(function(e,a){return r[a][t]}),i=n.filter(function(e,t){return n.indexOf(e)==t});a(null,i)}})}},{key:"urlForRestaurant",value:function(e){return"restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"img/"+(e.photograph+".jpg")}},{key:"favoriteHandler",value:function(t,a){var r=e.RESTAURANTS_URL+"/"+t+"/?is_favorite="+a;return e.sendData(r,{method:"PUT"},"restaurant")}},{key:"postReview",value:function(t){var a=e.REVIEWS_URL,r={method:"POST",body:JSON.stringify(t)};return e.sendData(a,r,"review")}},{key:"updateReview",value:function(t){var a=t.id;a.toString().startsWith("temp")||(a=parseInt(t.id));var r=e.REVIEWS_URL+"/"+a,n={method:"PUT",body:JSON.stringify(t)};return e.sendData(r,n,"review")}},{key:"deleteReview",value:function(t){if(t.toString().startsWith("temp"))return e.getTargetId(e.REVIEWS_URL+"/"+t,"review").then(function(t){e.deleteExistingRequest({targetId:t,target:"review"});return{request_status:"fail",target:"review",data:[]}});var a=e.REVIEWS_URL+"/"+parseInt(t);return e.sendData(a,{method:"DELETE"},"review")}},{key:"sendData",value:async function(t,a,r){var n=e.REQUEST_HEADERS;a.mode="cors",a.credentials="same-origin",a.headers=n,a.json=!0;var i=new Request(t,a);try{var u=fetch(i),s=await u,o=await s.json(),l={request_status:"success",target:r,data:e.refactorData(r,[o])[0]};return e.updateIndexedDB(l,a.method),Promise.resolve(l)}catch(n){var d=a;return d.target=r,d.url=t,d.data=[],e.handleFailedRequest(d)}}},{key:"getTargetId",value:function(t,a){var r=a+"s",n=t.split(r).pop();return"restaurant"===a?(n=n.split("/?is_favorite")[0],Promise.resolve(n.substring(1))):n?Promise.resolve(n.substring(1)):e.AppStore.getStoreKeys("failedRequests").then(function(e){return"temp"+(e.length+1)})}},{key:"deleteExistingRequest",value:function(t){e.AppStore.getCachedData("failedRequests").then(function(a){if(a.length>0){var r=a.filter(function(e){return e.target===t.target&&e.targetId===t.targetId});r.length>0&&e.AppStore.deleteOne("failedRequests",r[0].id)}})}},{key:"handleFailedRequest",value:function(t){var a={request_status:"fail",target:t.target,data:t.data};return e.INDEXED_DB_SUPPORT?e.getTargetId(t.url,t.target).then(function(r){var n={target:t.target,url:t.url,method:t.method,targetId:r};if("body"in t){var i=JSON.parse(t.body);"id"in i||(i.id=r),n.body=i,a.data=i}return e.deleteExistingRequest(n),e.AppStore.cacheOne("failedRequests",n),Promise.resolve(a)}):Promise.resolve(a)}},{key:"sortByID",value:function(e,t,a){return"asc"===a?parseFloat(e.id)-parseFloat(t.id):parseFloat(t.id)-parseFloat(e.id)}},{key:"sortByDate",value:function(e,t,a,r){return"asc"===a?parseFloat(new Date(e[r]).getTime())-parseFloat(new Date(t[r]).getTime()):parseFloat(new Date(t[r]).getTime())-parseFloat(new Date(e[r]).getTime())}},{key:"fetchFailedRequests",value:function(){return e.INDEXED_DB_SUPPORT?e.AppStore.getCachedData("failedRequests"):Promise.resolve([])}},{key:"clearIndexedBD",value:function(){e.AppStore.deleteAll("failedRequests"),e.AppStore.deleteAll("restaurants"),e.AppStore.deleteAll("reviews")}},{key:"RESTAURANTS_URL",get:function(){return appParams.endpoints.restaurants}},{key:"REVIEWS_URL",get:function(){return appParams.endpoints.reviews}},{key:"REQUEST_HEADERS",get:function(){var e=new Headers;return e.append("Accept","application/json; charset=utf-8"),e}},{key:"INDEXED_DB_SUPPORT",get:function(){var e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,t=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},a=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;return!!(e&&t&&a)}},{key:"AppStore",get:function(){return new DataStore}}]),e}();
"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var FileLoader=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getFilePosition",value:function(e){return{link:"head",script:"body"}[e]}},{key:"getFileParameters",value:function(e){return"css"===e.split(".").pop()?{rel:"stylesheet",charset:"utf-8",type:"text/css",href:e}:{type:"application/javascript",charset:"utf-8",src:e}}},{key:"createFile",value:function(e,t){for(var n=document.createElement(e),a=0;a<Object.keys(t).length;a++){var r=Object.keys(t)[a],c=t[r];n.setAttribute(r,c)}return n}},{key:"loadFile",value:function(e,t){var n=this;return new Promise(function(a,r){var c=n.createFile(e,t);c.readyState?c.onreadystatechange=function(){"loaded"==c.readyState||"complete"==c.readyState?(c.onreadystatechange=null,a()):r()}:c.onload=function(){a()},c.onerror=function(){r()},document[n.getFilePosition(e)].appendChild(c)})}}]),e}();
"use strict";var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var InterfaceManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"displayElement",value:function(e){e.classList.remove(appParams.cssClasses.hidden)}},{key:"hideElement",value:function(e){e.classList.add(appParams.cssClasses.hidden)}},{key:"setTabIndex",value:function(e,a){for(var t=0;t<e.length;t++)e[t].setAttribute("tabindex",a)}},{key:"hideLoader",value:function(){self.spinner.classList.remove(appParams.cssClasses.spinClass),e.hideElement(self.loader),e.displayElement(self.main)}},{key:"showLoader",value:function(){self.spinner.classList.add(appParams.cssClasses.spinClass),e.hideElement(self.main),e.displayElement(self.loader)}},{key:"loaderIsDisplayed",value:function(){return!self.loader.classList.contains(appParams.cssClasses.hidden)}},{key:"getUserView",value:function(){var e=window.location.href.split("/").pop().split(".")[0];return""===e?null:e}},{key:"getParameterByName",value:function(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}},{key:"redirectUser",value:function(e){window.location.replace(e)}},{key:"reloadApp",value:function(){DBHelper.clearIndexedBD(),window.location.href=window.location.href}},{key:"refreshApp",value:function(){DBHelper.clearIndexedBD(),window.location.reload(!0)}},{key:"decodeEntities",value:function(e){var a=document.createElement("textarea");return a.innerHTML=e,a.value}},{key:"formatDate",value:function(e){var a=new Date(e).toString().split(" ");return a[2]+" "+a[1]+" "+a[3]}},{key:"getTime",value:function(e){var a=new Date(e);return(a.getHours()<10?"0":"")+a.getHours()+":"+((a.getMinutes()<10?"0":"")+a.getMinutes())}},{key:"getDateTime",value:function(a){return e.formatDate(a)+", "+e.getTime(a)}},{key:"createButton",value:function(e,a,t,n){var r=document.createElement("button");return r.innerHTML=a,r.setAttribute("id",e),r.setAttribute("aria-label",t),r.addEventListener("click",n),r.type="button",r}},{key:"removeNoResultsFetchingeMessage",value:function(){var e=document.querySelectorAll(".fetcherMessageContainer");e.length>0&&e[0].remove()}},{key:"displayNoResultsFetchingMessage",value:function(e,a,t){var n=document.createElement("div");n.className="fetcherMessageContainer";var r=document.createElement("p");r.className="fetcherMessage",r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive");var s=document.createElement("i");s.classList.add("fas","fa-exclamation-triangle","feedback_icon");var l=document.createElement("p");l.innerHTML=appParams.noResultsFetchingMessages[e],l.className="fetcherFeedback",r.append(s,l),n.append(r),a.insertBefore(n,t)}},{key:"displayFreezer",value:function(){var e=document.createElement("div");e.className=appParams.cssClasses.freezer,document.body.appendChild(e)}},{key:"removeFreezer",value:function(){var e=document.querySelectorAll(".freezer");e.length>0&&e[0].remove()}}]),e}();
"use strict";var displayNotification=function(){self.notificationContainer.classList.add(appParams.cssClasses.displayNotification),self.notificationContainer.setAttribute("role","alert"),self.notificationContainer.setAttribute("aria-live","assertive")},hideNotification=function(){self.notificationContainer.classList.remove(appParams.cssClasses.displayNotification),self.notificationContainer.removeAttribute("role"),self.notificationContainer.removeAttribute("aria-live")},getNotificationContent=function(t){return appParams.notifications[t]},createNotificationContent=function(t){self.notificationTitle.innerHTML=t.title,self.notificationBody.innerHTML=t.message,self.notificationContainer.setAttribute("notification_type",t.type)},clearNotification=function(){createNotificationContent(getNotificationContent("clear")),self.notificationTimeout>0&&clearTimeout(self.notificationTimeout),self.notificationInterval>0&&clearNotificationCountDown(),InterfaceManager.removeFreezer()},addNotificationCountDown=function(t){self.notificationCountdown=0,self.notificationInterval=0,self.notificationCountdown=5;var i=document.getElementById("message_timer");i.innerHTML=self.notificationCountdown,self.notificationInterval=setInterval(function(){if(self.notificationCountdown--,self.notificationCountdown<1)return clearNotificationCountDown(),void t();i.innerHTML=self.notificationCountdown},1e3)},clearNotificationCountDown=function(){clearInterval(self.notificationInterval),self.notificationCountdown=0},closeNotification=function(t){t.preventDefault(),hideNotification(),"map_failure"===self.notificationContainer.getAttribute("notification_type")&&enableMap()},getButtonsContainer=function(){var t=self.notificationBody.querySelectorAll(".buttons_wrapper");return t.length>0?t=t[0]:(t=document.createElement("div")).classList.add("buttons_wrapper"),t},createGotItButton=function(){var t=getButtonsContainer(),i=InterfaceManager.createButton("btn_gotit","got it","close notification",closeNotification);i.classList.add("notification_button","gotit_btn"),t.append(i),self.notificationBody.append(t)},createNotificationActionButton=function(t,i,n,e){var o=getButtonsContainer(),a=InterfaceManager.createButton("btn_"+t,i,n,e);a.classList.add("notification_button","btn_"+t),o.append(a),self.notificationBody.append(o)},generateBasicNotification=function(t,i){clearNotification(),createNotificationContent(t),createGotItButton(),displayNotification(),i>0&&(self.notificationTimeout=setTimeout(function(){hideNotification()},i))},generateUpdateNotification=function(){clearNotification(),createNotificationContent(getNotificationContent("update")),createNotificationActionButton("update","update","update app",updateApp),createNotificationActionButton("dismiss","dismiss","dismiss update",dismissUpdate),displayNotification()},generateFailureNotification=function(t){var i=void 0;i=getNotificationContent(t?"failed_request_cached":"failed_request"),generateBasicNotification(i,15e3)},generateUnsavedChangesNotification=function(t){clearNotification(),createNotificationContent(getNotificationContent("unsaved_changes"));var i=1===t?"change":"changes";document.getElementById("unsaved_number").innerHTML=t,document.getElementById("unsaved_changes").innerHTML=i,createNotificationActionButton("savenow","save now","save changes now",saveNow),addNotificationCountDown(saveNow),InterfaceManager.displayFreezer(),displayNotification()},generateRefreshNotification=function(){clearNotification(),createNotificationContent(getNotificationContent("refresh")),createNotificationActionButton("refresh","refresh","refresh app",InterfaceManager.refreshApp),displayNotification()};
"use strict";var checkForFailedRequests=function(){return DBHelper.fetchFailedRequests().then(function(e){return e.length>0?e:[]})},saveNow=function(e){clearNotificationCountDown(),updateAppData(),generateBasicNotification(getNotificationContent("saving_changes"),15e3)},updateAppData=function(){checkForFailedRequests().then(function(e){e.length>0&&saveRequests(e)})},saveRequests=function e(t){if(t.length>0){var a=t[0],n=prepareRequestParams(a);setTimeout(function(){DBHelper.sendData(n.url,n.params,n.target).then(function(n){DBHelper.AppStore.deleteOne("failedRequests",a.id),t.shift(),e(t)})},500)}else checkForAppDataUpdate(!0)},checkForAppDataUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];checkForFailedRequests().then(function(t){t.length>0?generateUnsavedChangesNotification(t.length):e&&generateRefreshNotification()})},prepareRequestParams=function(e){var t={url:e.url,target:e.target,params:{method:e.method}};if("body"in e){var a=e.body;"id"in a&&a.id.toString().startsWith("temp")&&e.targetId.startsWith("temp")?(t.url=e.url.split("/temp")[0],t.params.method="POST",delete a.id,t.params.body=JSON.stringify(a)):t.params.body=JSON.stringify(a)}return t};
"use strict";var main=void 0,loader=void 0,spinner=void 0,mapContainer=void 0,mapButton=void 0,notificationContainer=void 0,notificationHeader=void 0,notificationTitle=void 0,notificationBody=void 0,newSWorker=void 0,notificationTimeout=void 0,notificationInterval=void 0,notificationCountdown=0;document.addEventListener("DOMContentLoaded",function(e){initApp()});var initApp=function(){self.main=document.getElementById("main"),self.loader=document.getElementById("loader_container"),self.spinner=document.getElementById("spinner"),self.mapButton=document.getElementById("mapButton"),self.mapContainer=document.getElementById("map_container"),self.notificationContainer=document.getElementById("notification_container"),self.notificationHeader=document.getElementById("notification_header"),self.notificationTitle=document.getElementById("notification_title"),self.notificationBody=document.getElementById("notification_body"),self.newSWorker=null,self.notificationTimeout=0,self.notificationInterval=0,self.notificationCountdown=0,registerServiceWorker(),DBHelper.fetchRestaurants(function(){})},initView=function(){switch(InterfaceManager.getUserView()){case"index":Promise.all(loadFiles("index")).then(function(){renderIndex()}).catch(function(e){clearNotification(),createNotificationContent(getNotificationContent("unable_to_connect_retrying")),createNotificationActionButton("retry","retry","retry to connect",InterfaceManager.refreshApp),addNotificationCountDown(function(){InterfaceManager.refreshApp()}),displayNotification()});break;case"restaurant":Promise.all(loadFiles("restaurant")).then(function(){renderRestaurantInfo()}).catch(function(e){clearNotification(),createNotificationContent(getNotificationContent("unable_to_connect_retrying")),createNotificationActionButton("retry","retry","retry to connect",InterfaceManager.refreshApp),addNotificationCountDown(function(){InterfaceManager.refreshApp()}),displayNotification()});break;default:InterfaceManager.redirectUser(appParams.start_url)}},loadFiles=function(e){var t=[];return appParams[e+"Files"].css.forEach(function(e){t.push(FileLoader.loadFile("link",FileLoader.getFileParameters(e)))}),appParams[e+"Files"].js.forEach(function(e){t.push(FileLoader.loadFile("script",FileLoader.getFileParameters(e)))}),t};window.addEventListener("online",function(e){e.preventDefault(),InterfaceManager.loaderIsDisplayed()?InterfaceManager.refreshApp():(enableMap(),checkForFailedRequests().then(function(e){e.length>0?generateUnsavedChangesNotification(e.length):generateBasicNotification(getNotificationContent("online"),8e3)}))}),window.addEventListener("offline",function(e){e.preventDefault();var t="";InterfaceManager.loaderIsDisplayed()?(clearNotification(),t=getNotificationContent("unable_to_connect_retrying"),createNotificationContent(t),createNotificationActionButton("retry","retry","retry to connect",InterfaceManager.reloadApp),addNotificationCountDown(function(){InterfaceManager.reloadApp()}),displayNotification()):(self.mapLoaded?t=getNotificationContent("offline"):(t=getNotificationContent("offline_noMap"),disableMap()),generateBasicNotification(t,1e4))});var registerServiceWorker=function(){"serviceWorker"in navigator?navigator.serviceWorker.register("ServiceWorker.js",{scope:appParams.app_scope}).then(function(e){navigator.serviceWorker.controller&&(e.waiting?updateReady(e.waiting):e.installing?trackInstalling(e.installing):e.addEventListener("updatefound",function(){trackInstalling(e.installing)}))}).catch(function(e){console.log("Oh No! Service Worker registration failed! Error: "+e)}):console.log("Oh No! Service Workers are not supported!")},trackInstalling=function(e){e.addEventListener("statechange",function(){"installed"==e.state&&updateReady(e)})},updateReady=function(e){self.newSWorker=e,generateUpdateNotification()},dismissUpdate=function(e){hideNotification()},updateApp=function(e){self.newSWorker.postMessage({action:"skipWaiting"}),hideNotification(),self.newSWorker=null};
