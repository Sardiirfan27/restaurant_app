"use strict";var comboBoxManager=function(e,t){e.addEventListener("keydown",function(o){var n={keyCode:o.keyCode,comboButton:e,comboBox:t,focusableElements:t.querySelectorAll(".selectoption")};handleComboBox(n)}),e.addEventListener("click",function(o){o.preventDefault();var n="false"!==e.getAttribute("aria-expanded"),a={comboButton:e,comboBox:t,focusableElements:t.querySelectorAll(".selectoption")};handleComboButton(e),n?(a.target="null",closeComboBox(a),updateRestaurants()):openComboBox(a)}),t.addEventListener("keydown",function(o){var n={keyCode:o.keyCode,comboButton:e,comboBox:t,focusableElements:t.querySelectorAll(".selectoption")};handleComboBox(n)}),t.addEventListener("click",function(o){o.preventDefault();var n={keyCode:o.keyCode,comboButton:e,comboBox:t,focusableElements:t.querySelectorAll(".selectoption"),target:o.target};handleComboButton(e),updateOptionAndButton(o.target,e),closeComboBox(n),updateRestaurants()}),hoverOptions(t.querySelectorAll(".selectoption"))},hoverOptions=function(e){e.forEach(function(e){e.addEventListener("mouseover",function(e){e.target.focus()})})},handleComboBox=function(e){var t=parseInt(e.comboButton.getAttribute("aria-activedescendant").split("_").pop()),o="false"!==e.comboButton.getAttribute("aria-expanded");switch(e.expanded=o,e.keyCode){case 40:event.preventDefault(),moveToNext(t+1,e.focusableElements,e.comboButton),o||updateRestaurants();break;case 38:event.preventDefault(),moveToPrev(t-1,e.focusableElements,e.comboButton),o||updateRestaurants();break;case 36:event.preventDefault(),moveToNext(e.focusableElements.length,e.focusableElements,e.comboButton),o||updateRestaurants();break;case 35:event.preventDefault(),moveToPrev(-1,e.focusableElements,e.comboButton),o||updateRestaurants();break;case 39:o||(event.preventDefault(),moveToNext(t+1,e.focusableElements,e.comboButton),updateRestaurants());break;case 37:o||(event.preventDefault(),moveToPrev(t-1,e.focusableElements,e.comboButton),updateRestaurants());break;case 13:event.preventDefault(),e.target=event.target,handleComboButton(e.comboButton),o?(closeComboBox(e),updateRestaurants()):openComboBox(e);break;case 27:case 9:o&&(event.preventDefault(),e.target=event.target,handleComboButton(e.comboButton),closeComboBox(e),updateRestaurants())}},closeComboBox=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];hideElement(e.comboBox),setTabIndex(e.focusableElements,-1),t||e.comboButton.focus(),"null"!=e.target&&e.comboButton.setAttribute("aria-activedescendant",e.target.id);for(var o=0;o<e.focusableElements.length;o++)e.focusableElements[o].classList.contains("selected")&&e.focusableElements[o].classList.remove("selected")},openComboBox=function(e){displayElement(e.comboBox),e.comboButton.blur();for(var t=e.comboButton.getAttribute("aria-activedescendant"),o=0;o<e.focusableElements.length;o++)e.focusableElements[o].setAttribute("aria-selected","false");var n=document.getElementById(t);n.classList.add("selected"),n.setAttribute("aria-selected","true"),setTabIndex(e.focusableElements,0),n.focus()},handleComboButton=function(e){var t="false"!==e.getAttribute("aria-expanded"),o=!1===t,n=!1===t?"arrow_down":"arrow_up",a=!1===t?"arrow_up":"arrow_down",s=!1===t?-1:0,u=e.getElementsByTagName("SPAN")[1];e.setAttribute("aria-expanded",o),e.setAttribute("tabindex",s),u.classList.remove(n),u.classList.add(a)},moveToPrev=function(e,t,o){updateOptionAndButton(e<0?t[t.length-1]:t[e],o)},moveToNext=function(e,t,o){e>t.length-1?updateOptionAndButton(t[0],o):updateOptionAndButton(t[e],o)},updateOptionAndButton=function(e,t){var o="false"!==t.getAttribute("aria-expanded");t.getElementsByTagName("SPAN")[0].innerHTML=e.innerHTML,t.setAttribute("aria-activedescendant",e.id),o&&e.focus()};
"use strict";var initMap=function(a,t,e,o){var n={integrity:"sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==",crossorigin:" "};loadStyle("https://unpkg.com/leaflet@1.3.1/dist/leaflet.css",function(){loadScript("https://unpkg.com/leaflet@1.3.1/dist/leaflet.js",function(){self.newMap=L.map("map",{center:[a,t],zoom:e,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoia2F0ZXJpbmF0emlhbGEiLCJhIjoiY2pwenNqdHF3MGU5MDQ4bzRudGdlanZ6eCJ9.kGbzX08otPecWpIvfKU3ZA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(self.newMap),self.initialized_map=!0,o()},n)},{integrity:"sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==",crossorigin:" "})},addMarkersToMap=function(a){a.forEach(function(a){var t=mapMarkerForRestaurant(a,self.newMap);function e(){window.location.href=t.options.url}self.markers.push(t),t.on("click",e),t.on("keypress",function(a){13===a.originalEvent.keyCode&&e()})})},displayHideMap=function(a){a.map_display?(a.map_container.classList.remove("hidden"),setTimeout(function(){a.map_container.classList.add("displaymap")},200)):(a.map_container.classList.remove("displaymap"),setTimeout(function(){a.map_container.classList.add("hidden")},800)),self.initialized_map||setTimeout(function(){initMap(a.lat,a.lng,a.map_zoom,function(){addMarkersToMap(a.restaurants)})},800)},mapMarkerForRestaurant=function(a,t){var e=new L.marker([a.latlng.lat,a.latlng.lng],{title:a.name,alt:a.name,url:DBHelper.urlForRestaurant(a)});return e.addTo(t),e};
"use strict";var neighborhoods=void 0,cuisines=void 0,restaurants=void 0,neighborhoodSelect=void 0,neighborhoodsList=void 0,cuisineSelect=void 0,cuisineList=void 0,restaurantsList=void 0,mapCheckbox=void 0,mapContainer=void 0,renderIndex=function(){self.initialized_map=!1,getIndexDomElements(),DBHelper.fetchRestaurants(function(e,t){e?callback(e,null):(resetRestaurants(t),fillRestaurantsHTML(),fetchNeighborhoods(),fetchCuisines(),hideLoader())}),self.mapCheckbox.addEventListener("keyup",function(e){if(13===e.keyCode){e.preventDefault();var t=document.getElementById("mapcheck");t.checked?t.checked=!1:t.checked=!0,toggleMap()}})};document.addEventListener("click",function(e){var t=document.querySelectorAll(".select_widget");t[0].contains(e.target)?closeSelectBox(self.cuisineSelect,self.cuisineList):t[1].contains(e.target)?closeSelectBox(self.neighborhoodSelect,self.neighborhoodsList):(closeSelectBox(self.neighborhoodSelect,self.neighborhoodsList),closeSelectBox(self.cuisineSelect,self.cuisineList))});var closeSelectBox=function(e,t){if("false"!==e.getAttribute("aria-expanded")){handleComboButton(e);var a={comboButton:e,comboBox:t,focusableElements:t.querySelectorAll(".selectoption"),target:"null"};closeComboBox(a,!0)}},toggleMap=function(){var e=document.getElementById("mapcheck").checked;self.mapCheckbox.setAttribute("aria-checked",e);var t={map_display:e,lat:40.722216,lng:-73.987501,map_zoom:12,restaurants:self.restaurants,map_container:self.mapContainer};displayHideMap(t)},getIndexDomElements=function(){self.neighborhoodSelect=document.getElementById("select_neighborhood"),self.neighborhoodsList=document.getElementById("neighborhoods_list"),self.cuisineSelect=document.getElementById("select_cuisine"),self.cuisineList=document.getElementById("cuisine_list"),self.restaurantsList=document.getElementById("restaurantsList"),self.mapCheckbox=document.getElementById("maptoggler"),self.mapContainer=document.getElementById("map_container")},updateRestaurants=function(){var e=self.cuisineSelect.getAttribute("aria-activedescendant"),t=self.neighborhoodSelect.getAttribute("aria-activedescendant"),a=document.getElementById(e).getAttribute("value"),r=document.getElementById(t).getAttribute("value");DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,r,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.restaurantsList;self.restaurants=[],t.innerHTML="",removeFetcherMessage(),self.markers&&self.markers.forEach(function(e){return e.remove()}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.restaurantsList;e.length>0?(e.forEach(function(e){t.append(createRestaurantHTML(e))}),!0===self.initialized_map&&addMarkersToMap(self.restaurants)):fetcherMessage("filters",document.getElementById("filterResults"),self.restaurantsList)},createRestaurantHTML=function(e){var t=document.createElement("li");t.className="restaurantCard",t.setAttribute("role","listitem");var a=document.createElement("div");a.className="imageContainer";var r=document.createElement("img");r.alt="photo of restaurant: "+e.name,r.className="restaurantImg",r.src=DBHelper.imageUrlForRestaurant(e),a.append(r);var s=document.createElement("h2");s.innerHTML=e.name,s.className="restaurantName",s.setAttribute("aria-label",e.name+" , "+e.neighborhood);var i=document.createElement("p");i.innerHTML=e.neighborhood,i.className="neighborhood";var o=document.createElement("p");o.className="address",o.innerHTML=e.address;var n=document.createElement("a");return n.className="more",n.setAttribute("role","button"),n.setAttribute("aria-label","view details about restaurant "+e.name),n.setAttribute("title","View Details About Restaurant: "+e.name),n.innerHTML="View Details",n.href=DBHelper.urlForRestaurant(e),t.append(createFavoriteBookmark(e),a,s,i,o,n),t},createFavoriteBookmark=function(e){var t=document.createElement("div");t.className="favoriteBookmark";var a=document.createElement("i");a.classList.add("bookmark","material-icons"),a.innerHTML="bookmark";var r='<i id="'+("heart_"+e._id)+'" class="material-icons heart">favorite</i>',s=createButton("favoriteBookmark_"+e._id,r,"mark restaurant as favorite",favoriteToggler);return s.className="favoriteButton",t.append(a,s),toggleFavoriteDisplay(s,e.is_favorite),t},toggleFavoriteDisplay=function(e,t){var a="true"===t.toString();e.setAttribute("aria-pressed",a);var r=!0===a?"Unmark restaurant from favorites!":"Add restaurant to favorites!",s=!0===a?"remove restaurant from favorites":"mark restaurant as favorite";e.setAttribute("title",r),e.setAttribute("aria-label",s);var i=!0===a?"favored":"unFavorite",o=!0===a?"unFavorite":"favored",n=e.childNodes[0];n.classList.remove(o),n.classList.add(i)},favoriteToggler=function(e){var t=e.target.getAttribute("id").split("_").pop(),a=document.getElementById("favoriteBookmark_"+t),r="true"!==a.getAttribute("aria-pressed").toString();toggleFavoriteDisplay(a,r),DBHelper.favoriteHandler(t,r).then(function(e){switch(e.request_status){case"fail":if(displayFailureNotification(e.idbsupport),e.idbsupport)toggleFavoriteDisplay(a,e.data.is_favorite),self.restaurants.find(function(e){return e._id===t}).is_favorite=e.data.is_favorite;break;default:toggleFavoriteDisplay(a,e.data.is_favorite),self.restaurants.find(function(e){return e._id===t}).is_favorite=e.data.is_favorite}})},fetchNeighborhoods=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants;self.neighborhoods=[],self.neighborhoods=DBHelper.fetchUniqueAttributes(e,"neighborhood"),fillOptionsHTML(self.neighborhoodsList,self.neighborhoods,"n"),comboBoxManager(self.neighborhoodSelect,self.neighborhoodsList)},fetchCuisines=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants;self.cuisines=[],self.cuisines=DBHelper.fetchUniqueAttributes(e,"cuisine_type"),fillOptionsHTML(self.cuisineList,self.cuisines,"c"),comboBoxManager(self.cuisineSelect,self.cuisineList)},fillOptionsHTML=function(e,t,a){var r=1;e.getElementsByTagName("LI")[0].setAttribute("aria-setsize",t.length+1),t.forEach(function(s){var i=document.createElement("li");i.setAttribute("role","option"),i.setAttribute("value",s),i.setAttribute("id",a+"_opt_"+r),i.classList.add("selectoption"),i.setAttribute("aria-setsize",t.length+1),i.setAttribute("aria-posinset",r+1),i.setAttribute("aria-selected","false"),i.innerHTML=s,e.append(i),r++})};
