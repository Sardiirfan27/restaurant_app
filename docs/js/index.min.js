"use strict";var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var SelectWidget=function(){function e(t,s,n,i,a){_classCallCheck(this,e),this.selectButton=t,this.selectList=s,this.optionKey=n,this.onOptionSelect=i,this.fillSelectOptionsHTLM(a)}return _createClass(e,[{key:"fillSelectOptionsHTLM",value:function(e){this.selectList.innerHTML="";for(var t=0;t<e.length;t++){var s=0===t,n=document.createElement("li");n.setAttribute("id",this.optionKey+"_opt_"+t),n.setAttribute("role","option"),n.setAttribute("value",e[t]),n.classList.add("selectoption"),n.setAttribute("aria-setsize",e.length+1),n.setAttribute("aria-posinset",t+1),n.setAttribute("aria-selected",s),n.innerHTML=e[t],this.selectList.append(n)}this.selectList.setAttribute("aria-activedescendant",this.optionKey+"_opt_0"),this.selectList.setAttribute("aria-expanded","false"),this.expanded=!1,this.focusableElements=this.selectList.querySelectorAll(".selectoption"),this.hoverOptions(),this.selectWidgetManager()}},{key:"hoverOptions",value:function(){this.focusableElements.forEach(function(e){e.addEventListener("mouseover",function(e){e.target.focus()})})}},{key:"selectWidgetManager",value:function(){var e=this;this.selectButton.addEventListener("keydown",function(t){e.handleSelectWidgetInteraction(t.keyCode)}),this.selectButton.addEventListener("click",function(t){t.preventDefault(),e.toggleDisplayManager(e.expanded),e.toggleSelectOptions("null")}),this.selectList.addEventListener("keydown",function(t){e.handleSelectWidgetInteraction(t.keyCode)}),this.selectList.addEventListener("click",function(t){t.preventDefault(),e.updateOptionAndButton(t.target),e.closeSelectBox(t.target),e.onOptionSelect()})}},{key:"handleSelectWidgetInteraction",value:function(e){var t=parseInt(this.selectList.getAttribute("aria-activedescendant").split("_").pop());switch(this.expanded="false"!==this.selectList.getAttribute("aria-expanded"),e){case 40:event.preventDefault(),this.moveToNext(t+1),this.selectOptionWhenClosed();break;case 38:event.preventDefault(),this.moveToPrev(t-1),this.selectOptionWhenClosed();break;case 36:event.preventDefault(),this.moveToNext(this.focusableElements.length),this.selectOptionWhenClosed();break;case 35:event.preventDefault(),this.moveToPrev(-1),this.selectOptionWhenClosed();break;case 39:this.expanded||(event.preventDefault(),this.moveToNext(t+1)),this.selectOptionWhenClosed();break;case 37:this.expanded||(event.preventDefault(),this.moveToPrev(t-1)),this.selectOptionWhenClosed();break;case 13:event.preventDefault(),this.toggleDisplayManager(this.expanded),this.toggleSelectOptions(event.target);break;case 27:case 9:this.expanded&&(event.preventDefault(),this.toggleDisplayManager(this.expanded),this.toggleSelectOptions(event.target))}}},{key:"moveToNext",value:function(e){e>this.focusableElements.length-1?this.updateOptionAndButton(this.focusableElements[0]):this.updateOptionAndButton(this.focusableElements[e])}},{key:"moveToPrev",value:function(e){e<0?this.updateOptionAndButton(this.focusableElements[this.focusableElements.length-1]):this.updateOptionAndButton(this.focusableElements[e])}},{key:"selectOptionWhenClosed",value:function(){this.expanded||this.onOptionSelect()}},{key:"updateOptionAndButton",value:function(e){e.setAttribute("aria-selected",!0),this.selectButton.getElementsByTagName("SPAN")[0].innerHTML=e.innerHTML,this.selectList.setAttribute("aria-activedescendant",e.id),this.expanded&&e.focus()}},{key:"toggleDisplayManager",value:function(e){var t=!1===e?"fa-caret-down":"fa-caret-up",s=!1===e?"fa-caret-up":"fa-caret-down",n=this.selectButton.getElementsByTagName("SPAN")[1];n.classList.remove(t),n.classList.add(s);var i=!1===e?-1:0;this.selectList.setAttribute("aria-expanded",!e),this.selectButton.setAttribute("tabindex",i)}},{key:"toggleSelectOptions",value:function(e){this.expanded?(this.closeSelectBox(e),this.onOptionSelect()):this.openSelectBox()}},{key:"openSelectBox",value:function(){InterfaceManager.displayElement(this.selectList),this.selectButton.blur();for(var e=this.selectList.getAttribute("aria-activedescendant"),t=0;t<this.focusableElements.length;t++)this.focusableElements[t].setAttribute("aria-selected","false");var s=document.getElementById(e);s.classList.add("selected"),s.setAttribute("aria-selected","true"),InterfaceManager.setTabIndex(this.focusableElements,0),s.focus(),this.expanded=!0}},{key:"closeSelectBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];InterfaceManager.hideElement(this.selectList),InterfaceManager.setTabIndex(this.focusableElements,-1),t||this.selectButton.focus(),"null"!=e&&this.selectList.setAttribute("aria-activedescendant",e.id);for(var s=0;s<this.focusableElements.length;s++)this.focusableElements[s].classList.remove("selected");this.expanded=!1,this.toggleDisplayManager(!0)}}]),e}();
"use strict";var mapBoxLayer=null,mapMarkers=[],mapTimeout=0,mapInitializing=!1,mapLoaded=!1,toggleMap=function(){var a=self.mapButton.getAttribute("aria-label").split(" ")[0].toLowerCase();(toggleMapButtonDisplay(a),self.mapLoaded)?(toggleMapDisplay("show"===a),"restaurant"!==InterfaceManager.getUserView()&&(self.neighborhoodSelectWidget.closeSelectBox("null",!0),self.cuisineSelectWidget.closeSelectBox("null",!0))):initMap(getMapInitParams())},toggleMapButtonDisplay=function(a){var e="show"===a?"hide":"show",t=getMabButtonLabelTitle(e);self.mapButton.setAttribute("aria-label",t),self.mapButton.title=t,"hide"===e?(self.mapButton.classList.remove("location_icon","fa-map-marker-alt"),self.mapButton.classList.add("map_icon","fa-map")):(self.mapButton.classList.remove("map_icon","fa-map"),self.mapButton.classList.add("location_icon","fa-map-marker-alt"))},getMabButtonLabelTitle=function(a){var e=a+" "+("restaurant"===InterfaceManager.getUserView()?"restaurant":"results")+" "+("show"===a?"on":"from")+" map";return e.charAt(0).toUpperCase()+e.slice(1)},getMapInitParams=function(){return"restaurant"===InterfaceManager.getUserView()?{lat:self.restaurant.latlng.lat,lng:self.restaurant.latlng.lng,zoomLevel:16,restaurants:[self.restaurant]}:{lat:40.722216,lng:-73.987501,zoomLevel:12,restaurants:self.restaurants}},resetMap=function(){self.mapBoxLayer=null,removeMarkers(),self.mapTimeout=0,self.mapInitializing=!1,self.mapLoaded=!1},initMap=function(a){resetMap(),self.mapInitializing=!0,displayMap(),setTimeout(function(){Promise.all([FileLoader.loadFile("link",appParams.mapBox.cssFile),FileLoader.loadFile("script",appParams.mapBox.jsFile)]).then(function(){self.mapBoxLayer=new L.map("map",{center:[a.lat,a.lng],zoom:a.zoomLevel,scrollWheelZoom:!1}),L.tileLayer(appParams.mapBox.leaflet_tile_layer_link,appParams.mapBox.leaflet_params).addTo(self.mapBoxLayer),self.mapLoaded=!0,addMarkersToMap(a.restaurants),self.mapInitializing=!1}).catch(function(a){self.mapLoaded=!1,mapFailure()})},700)},displayMap=function(){InterfaceManager.displayElement(self.mapContainer),self.mapTimeout=setTimeout(function(){self.mapContainer.classList.add(appParams.cssClasses.displayMap)},200)},hideMap=function(){self.mapContainer.classList.remove(appParams.cssClasses.displayMap),self.mapTimeout=setTimeout(function(){InterfaceManager.hideElement(self.mapContainer)},800)},toggleMapDisplay=function(a){self.mapLoaded?self.mapInitializing||(clearTimeout(self.mapTimeout),a?displayMap():hideMap()):mapFailure()},addMarkersToMap=function(a){self.mapBoxLayer&&self.mapLoaded&&a.forEach(function(a){var e={title:a.name,alt:a.name,url:DBHelper.urlForRestaurant(a)},t=new L.marker([a.latlng.lat,a.latlng.lng],e);t.addTo(self.mapBoxLayer),self.mapMarkers.push(t);var l=function(){window.location.href=t.options.url};t.on("click",l),t.on("keypress",function(a){13===a.originalEvent.keyCode&&l()})})},removeMarkers=function(){self.mapBoxLayer&&self.mapLoaded&&self.mapMarkers&&self.mapMarkers.length>0&&self.mapMarkers.forEach(function(a){return a.remove()}),self.mapMarkers=[]},enableMap=function(){self.mapButton.setAttribute("onclick","toggleMap(event)"),self.mapButton.classList.remove(appParams.cssClasses.disableMapButton),toggleMapButtonDisplay("hide")},disableMap=function(){self.mapContainer.classList.remove(appParams.cssClasses.displayMap),InterfaceManager.hideElement(self.mapContainer),self.mapButton.removeAttribute("onclick"),self.mapButton.classList.add(appParams.cssClasses.disableMapButton),toggleMapButtonDisplay("hide"),self.mapButton.setAttribute("aria-label","Map is currently unavailable"),self.mapButton.title="Map is currently unavailable",self.mapButton.blur(),resetMap()},mapFailure=function(){disableMap(),generateBasicNotification(getNotificationContent("map_failure"),0)};
"use strict";var createFavoriteBookmark=function(t){var e=document.createElement("div");e.classList.add("favoriteToggler");var a=document.createElement("div");a.classList.add("fas","fa-bookmark","favoriteBookmark");var r=InterfaceManager.createButton("favoriteBookmark_"+t.id,"","mark restaurant as favorite",toggleFavorite);return r.title="mark restaurant as favorite",r.classList.add("fas","fa-heart","favoriteButton"),e.append(a,r),toggleFavoriteDisplay(r,t.is_favorite),e},toggleFavoriteDisplay=function(t,e){var a="true"===e.toString();t.setAttribute("aria-pressed",a);var r=!0===a?"Unmark restaurant from favorites!":"Add restaurant to favorites!",s=!0===a?"remove restaurant from favorites":"mark restaurant as favorite";t.setAttribute("title",r),t.setAttribute("aria-label",s);var i=!0===a?"favored":"unFavorite",n=!0===a?"unFavorite":"favored";t.classList.remove(n),t.classList.add(i)},toggleFavorite=function(t){t.preventDefault();var e=parseInt(t.target.getAttribute("id").split("_").pop()),a=document.getElementById("favoriteBookmark_"+e),r="true"!==a.getAttribute("aria-pressed").toString();a.blur(),DBHelper.favoriteHandler(e,r).then(function(t){switch(t.request_status){case"fail":generateFailureNotification(DBHelper.INDEXED_DB_SUPPORT),DBHelper.INDEXED_DB_SUPPORT&&(toggleFavoriteDisplay(a,r),updateRestaurantVarsOnFail({id:e,is_favorite:r}));break;default:toggleFavoriteDisplay(a,r),updateRestaurantVars(t.data)}})},updateRestaurantVarsOnFail=function(t){if("restaurant"===InterfaceManager.getUserView())self.restaurant.is_favorite=t.is_favorite,DBHelper.updateIndexedDB({target:"restaurant",data:self.restaurant},"PUT");else{var e=self.restaurants.filter(function(e){return e.id!==t.id}),a=self.restaurants.filter(function(e){return e.id===t.id})[0];a.is_favorite=t.is_favorite,DBHelper.updateIndexedDB({target:"restaurant",data:a},"PUT"),e.push(a),e.sort(function(t,e){return DBHelper.sortByID(t,e,"asc")}),self.restaurants=[],self.restaurants=e}},updateRestaurantVars=function(t){if("restaurant"===InterfaceManager.getUserView())self.restaurant=t;else{var e=self.restaurants.filter(function(e){return e.id!=t.id});e.push(t),e.sort(function(t,e){return DBHelper.sortByID(t,e,"asc")}),self.restaurants=[],self.restaurants=e}};
"use strict";var restaurants=void 0,neighborhoods=void 0,cuisines=void 0,neighborhoodSelect=void 0,neighborhoodsList=void 0,cuisineSelect=void 0,cuisineList=void 0,neighborhoodSelectWidget=void 0,cuisineSelectWidget=void 0,restaurantsList=void 0,restaurantResults=void 0,renderIndex=function(){self.neighborhoodSelect=document.getElementById("select_neighborhood"),self.neighborhoodsList=document.getElementById("neighborhoods_list"),self.cuisineSelect=document.getElementById("select_cuisine"),self.cuisineList=document.getElementById("cuisine_list"),self.restaurantsList=document.getElementById("restaurantsList"),self.restaurantResults=document.getElementById("filterResults"),self.neighborhoodSelectWidget=null,self.cuisineSelectWidget=null,self.neighborhoods=[],self.cuisines=[],updateRestaurants(),fetchNeighborhoods(),fetchCuisines()};document.addEventListener("click",function(e){var t=document.querySelectorAll(".select_widget");t[0].contains(e.target)?self.cuisineSelectWidget.closeSelectBox("null",!0):t[1].contains(e.target)?self.neighborhoodSelectWidget.closeSelectBox("null",!0):(self.neighborhoodSelectWidget.closeSelectBox("null",!0),self.cuisineSelectWidget.closeSelectBox("null",!0))});var fetchNeighborhoods=function(){DBHelper.fetchUniqueRestaurantParams("neighborhood",function(e,t){if(e)console.error(e);else{self.neighborhoods=t.sort();var s=self.neighborhoods;s.unshift("All Neighborhoods"),self.neighborhoodSelectWidget=new SelectWidget(self.neighborhoodSelect,self.neighborhoodsList,"n",updateRestaurants,s)}})},fetchCuisines=function(){DBHelper.fetchUniqueRestaurantParams("cuisine_type",function(e,t){if(e)console.error(e);else{self.cuisines=t.sort();var s=self.cuisines;s.unshift("All Cuisines"),self.cuisineSelectWidget=new SelectWidget(self.cuisineSelect,self.cuisineList,"c",updateRestaurants,s)}})},updateRestaurants=function(){var e=self.cuisineList.getAttribute("aria-activedescendant"),t=self.neighborhoodsList.getAttribute("aria-activedescendant"),s=document.getElementById(e).getAttribute("value");s=s.startsWith("All")?"all":s;var n=document.getElementById(t).getAttribute("value");n=n.startsWith("All")?"all":n,DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,n,function(e,t){e?console.error(e):(resetRestaurants(t),InterfaceManager.hideLoader(),t.length>0?fillRestaurantsHTML():InterfaceManager.displayNoResultsFetchingMessage("restaurants",self.restaurantResults,self.restaurantsList))})},resetRestaurants=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.restaurantsList;self.restaurants=[],t.innerHTML="",InterfaceManager.removeNoResultsFetchingeMessage(),removeMarkers(),self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.restaurantsList;e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap(self.restaurants)},createRestaurantHTML=function(e){var t=document.createElement("li");t.className="restaurantCard",t.setAttribute("role","listitem");var s=document.createElement("div");s.className="imageContainer";var n=document.createElement("img");n.alt="photo of restaurant: "+e.name,n.className="restaurantImg",n.src=DBHelper.imageUrlForRestaurant(e),s.append(n);var r=document.createElement("h2");r.innerHTML=e.name,r.className="restaurantName",r.setAttribute("aria-label",e.name+" , "+e.neighborhood);var a=document.createElement("p");a.innerHTML=e.neighborhood,a.className="neighborhood";var i=document.createElement("p");i.className="address",i.innerHTML=e.address;var o=document.createElement("a");return o.className="more",o.setAttribute("role","button"),o.setAttribute("aria-label","view details about restaurant "+e.name),o.setAttribute("title","View Details About Restaurant: "+e.name),o.innerHTML="View Details",o.href=DBHelper.urlForRestaurant(e),t.append(createFavoriteBookmark(e),s,r,a,i,o),t};
